# Copilot Instructions for Patchwork

## Documentation Guidelines

- **Always update documentation** when making changes to functionality:
  - Update `README.md` with any new features, configuration options, or usage examples
  - Update `assets/index.html` if the changes affect the web interface or user-facing features
  - Keep documentation accurate and in sync with the code

- **Reference, don't duplicate**: These instructions should reference the `README.md` for comprehensive documentation rather than duplicating it. The `README.md` is the authoritative source for:
  - Project overview and philosophy
  - API endpoints and usage examples
  - Configuration options and environment variables
  - Installation and deployment instructions
  - Examples and use cases

## Development and Testing Guidelines

- **Use multiple terminals** for development and testing:
  - Start the server in one terminal: `./patchwork start --port 8080`
  - Run tests or client commands in separate terminals
  - **Never use background processes** (`&`) as they make it confusing and hard to track running processes
  - Use separate terminal sessions to maintain clear separation of concerns

## Project Structure

- **Main application**: `main.go` contains the core server implementation
- **Assets**: `assets/` directory contains embedded web assets and static files
- **Documentation**: `README.md` is the primary documentation source
- **Configuration**: Environment variables and CLI flags control server behavior

## Key Features to Maintain

1. **Configurable port**: Server port via `--port` CLI flag
2. **Hook system**: Forward (`/h`) and reverse (`/r`) hooks with HMAC-SHA256 secrets
3. **Multiple namespaces**: Public (`/p`), hooks (`/h`, `/r`), and user (`/u/{username}`) namespaces
4. **Channel communication**: MPMC queue with optional pubsub mode
5. **Security**: HMAC-based authentication for hook endpoints

## Environment Variables

Refer to `README.md` for the complete list of supported environment variables including:
- `SECRET_KEY`: For hook HMAC generation
- `FORGEJO_URL`: Forgejo/Gitea backend URL
- `ACL_TTL`: ACL cache duration
- `LOG_LEVEL`: Logging verbosity
- `LOG_SOURCE`: Include source information in logs

## Testing Approach

1. Build the application: `go build -o patchwork .`
2. Start server in dedicated terminal: `./patchwork start --port <port>`
3. Test endpoints in separate terminals using `curl` commands
4. Stop server with Ctrl+C in the server terminal
5. Clean up binaries when done

This approach ensures clear process management and easier debugging during development.
